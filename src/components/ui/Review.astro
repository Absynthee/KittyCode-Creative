---
// Review.astro
import { Star, User } from "@lucide/astro";
import Avatar from "@/components/ui/Avatar.astro";

interface Reviews {
  author_name: string;
  profile_photo_url: string;
  rating: number;
  relative_time_description: string;
  text: string;
  time: number;
}

interface Props {
  reviews?: Reviews[];
}

const {
  reviews = [
    {
      author_name: "Kevin Yu",
      rating: 5,
      text: "Austin really helped me bring some of my ideas closer to reality. He's very knowledgeable in his domain and was able to suggest ways we could bring my vision to life, whether it's my portfolio site or smaller ideas that just randomly popped up as I engaged with him. I found Austin to be extremely professional, timely, and overall a great resource when it comes to all of my website inquiries. 5/5 and I strongly recommend going with his services if you want to take an idea all the way to completion.",
      relative_time_description: "11 weeks ago",
      profile_photo_url:
        "https://lh3.googleusercontent.com/a-/ALV-UjX8YjtqSNrj0AXbVqu9tip6YWURpVGMyPFSRJunxqc0cauQgaJb1w=s40-c-rp-mo-ba6-br100",
      time: Math.floor(Date.now() / 1000) - 14 * 24 * 60 * 60,
    },
    {
      author_name: "Cookie",
      rating: 5,
      text: "Working with kitty code creative on my website was easy and fluid, they responded to my requests the same day and pitched in a lot of ideas that ended up being better than what i'd come up with anyway. The website they've made me is now my landing pad for everyone on the internet to get to know me as a brand so i'm beyond thrilled with how it's all turned out.",
      relative_time_description: "7 months ago",
      profile_photo_url:
        "https://lh3.googleusercontent.com/a-/ALV-UjUW7BiryhWt2ITlZVGbxXopaf-H3__GS6r8Yk6UmtSdQaYYjKo=s40-c-rp-mo-br100",
      time: Math.floor(Date.now() / 1000) - 30 * 24 * 60 * 60,
    },
    {
      author_name: "Rose Butcher",
      rating: 5,
      text: "Austin really impressed me with their attention to detail when designing my new business website. Every part was so well thought out, and I appreciated them going the extra mile to add in the interactive and animated elements I asked for. To any startup small business, entrepreneur, or influencer looking for a responsive, fast and aesthetically pleasing website, I'd definitely recommend Kitty Code Creative! ðŸ˜º",
      relative_time_description: "12 months ago",
      profile_photo_url:
        "https://lh3.googleusercontent.com/a-/ALV-UjXPxC0okuyqcHzOYTnXBqq_JogI3MtR3RXlieBx0dVGS4Nfebz8=s40-c-rp-mo-br100",
      time: Math.floor(Date.now() / 1000) - 60 * 24 * 60 * 60,
    },
  ],
} = Astro.props;

function generateStars(rating: number) {
  return Array.from({ length: 5 }, (_, i) => i < rating);
}

function truncateText(text: string, maxLength: number = 500) {
  if (text.length <= maxLength) return text;
  return text.slice(0, maxLength).trim() + "...";
}
---

<div class="testimonials-container">
  {
    reviews.length > 0 ? (
      <div class="reviews-grid" role="list">
        {reviews.map((review, index) => (
          <article
            class="review-card"
            role="listitem"
            style={`--delay: ${index * 0.1}s`}
          >
            <div class="review-header">
              <div class="reviewer-info">
                <Avatar
                  src={review.profile_photo_url}
                  alt={`${review.author_name}'s profile photo`}
                  size="large"
                  variant="default"
                />
                <div class="reviewer-details">
                  <h3 class="reviewer-name">{review.author_name}</h3>
                  <time
                    class="review-date"
                    dateTime={new Date(review.time * 1000).toISOString()}
                  >
                    {review.relative_time_description}
                  </time>
                </div>
              </div>
            </div>

            <div
              class="rating"
              role="img"
              aria-label={`${review.rating} out of 5 stars`}
            >
              {generateStars(review.rating).map((filled) => (
                <Star
                  size={24}
                  class={filled ? "star-filled" : "star-empty"}
                  aria-hidden="true"
                />
              ))}
              <span class="sr-only">{review.rating} out of 5 stars</span>
            </div>

            <blockquote class="review-text">
              <p>{truncateText(review.text)}</p>
            </blockquote>
          </article>
        ))}
      </div>
    ) : (
      <div class="no-reviews" role="status">
        <User size={48} aria-hidden="true" />
        <p>No reviews available at the moment.</p>
      </div>
    )
  }
</div>

<style>
  .testimonials-container {
    margin: 0 auto;
    padding: var(--space-l) 0;
    width: 100%;
  }

  .reviews-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
    gap: 2rem;
  }

  .review-card {
    background: hsl(from var(--card) h s l / 0.05);
    border: 1px solid var(--primary);
    border-radius: var(--radius);
    padding: var(--space-m);
    transition: all 0.3s ease;
    animation: slideInUp 0.6s ease-out var(--delay) both;
  }

  .review-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px hsl(from var(--foreground) h s l / 0.1);
  }

  .review-header {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .reviewer-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    min-width: 0;
  }

  .reviewer-details {
    min-width: 0;
  }

  .reviewer-name {
    font-size: var(--step-0);
    font-weight: 600;
    margin: 0;
    color: var(--foreground);
  }

  .review-date {
    font-size: var(--step--1);
    color: hsl(from var(--foreground) h s l / 0.6);
    display: block;
  }

  .rating {
    display: flex;
    gap: 0.125rem;
    margin-bottom: 0.5rem;
  }

  .star-filled {
    color: #fbbf24;
    fill: currentColor;
  }

  .star-empty {
    color: hsl(from var(--border) h s l / 0.5);
  }

  .review-text {
    margin: 1rem 0;
    border: none;
    padding: 0;
  }

  .review-text p {
    font-size: var(--step-0);
    color: hsl(from var(--foreground) h s l / 0.8);
    margin: 0;
  }

  .no-reviews {
    display: grid;
    place-items: center;
    padding: 3rem 0;
    color: hsl(from var(--foreground) h s l / 0.6);
  }

  .no-reviews svg {
    margin-bottom: 1rem;
    opacity: 0.5;
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (max-width: 768px) {
    .testimonials-container {
      padding: 2rem 1rem;
    }

    .reviews-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .review-header {
      flex-direction: column;
      gap: 0.75rem;
    }

    .reviewer-info {
      width: 100%;
    }
  }
</style>
